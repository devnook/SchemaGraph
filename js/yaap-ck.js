function appendPropertyValue(e,t,n,r){var i=e.parentNode.children.length-1;if(i>0&&!n)return;var s=document.createElement("div");s.innerHTML=renderPropertyValue(t+(n?"."+i:""),r);e.parentNode.appendChild(s)}function renderPropertyValue(e,t){var n="";typeof t=="string"?n+="<input type='text' name='"+e+"'>":typeof t=="object"&&(n+=renderSupportedClass(e+".",t));return n}function renderSupportedClass(e,t){var n="";n+="<div class='supported-class'>";n+="@type: "+t.subClassOf+"";n+="<div class='supported-property'>";var r=t.supportedProperty||[];for(var i=0;i<r.length;i++){n+="<div class='name'>"+r[i].name+"</div>";n+="<div class='value'>";console.log(r[i].occurs);var s=r[i].occurs&&(r[i].occurs=="One-or-Many"||r[i].occurs=="Zero-or-Many"),o=r[i].occurs&&(r[i].occurs=="One-or-Zero"||r[i].occurs=="Zero-or-Many"),u=e+r[i].name;if(s||o){var a=JSON.stringify(r[i].rangeIncludes);n+="<span class='add' onclick='appendPropertyValue(this, \""+(e+r[i].name)+'", '+s+", "+a+")'>+</span>"}o||(n+=renderPropertyValue(u+(s?".0":""),r[i].rangeIncludes));n+="</div>";n+="<div style='clear: both;'></div>"}n+="</div>";n+="</div>";return n}function parseJsonLd(e){var t=e.getElementsByTagName("script")[0];return JSON.parse(t.innerHTML)}function loading(){document.getElementById("action").className="loading"}function loaded(){document.getElementById("action").className="loaded"}function parseHtml(e,t){var n=t.responseXML,r=n.getElementsByTagName("*"),i=[];for(var s=0;s<r.length;s++)if(r[s].attributes.getNamedItem("itemscope")){var o=r[s].attributes.getNamedItem("itemid").nodeValue,u=o.substr(0,3)=="http"?o:e+o;i.push({src:u,innerHTML:r[s].innerHTML})}return i}function parseXml(e,t){var n=t.responseXML,r=parseJsonLd(n);return r}function toAbsoluteUrl(e,t){var n={};for(var r in t)if(t[r]instanceof Array){n[r]=[];for(var i=0;i<t[r].length;i++)typeof t[r][i]=="object"?n[r].push(toAbsoluteUrl(e,t[r][i])):n[r].push(t[r][i])}else if(typeof t[r]=="object")n[r]=toAbsoluteUrl(e,t[r]);else if(r=="@id"&&t[r].substr(0,4)!="http"){var s=new goog.Uri(e);s.setPath(t[r]);n[r]=s.toString()}else n[r]=t[r];return n}function linkifyId(e){var t={};for(var n in e)if(e[n]instanceof Array){t[n]=[];for(var r=0;r<e[n].length;r++)typeof e[n][r]=="object"?t[n].push(linkifyId(e[n][r])):t[n].push(e[n][r])}else typeof e[n]=="object"?t[n]=linkifyId(e[n]):n=="@id"?t[n]="<a href='"+e[n]+"'>"+e[n]+"</a>":t[n]=e[n];return t}function findObjectById(e,t){if(e["@id"]==t)return e;for(var n in e)if(e[n]instanceof Array)for(var r=0;r<e[n].length;r++){var i=findObjectById(e[n][r],t);if(i!=null)return i}else if(typeof e[n]=="object"){var i=findObjectById(e[n],t);if(i!=null)return i}return null}function renderJson(e,t){console.log(t);document.getElementById("log").innerHTML=JSON.stringify(linkifyId(toAbsoluteUrl(e,t)),undefined,2)}function fetchService(e,t){loading();var n=new Crawler;n.addCallback(parseXml.bind(null,e));n.addCallback(function(n){loaded();renderJson(e,n);t(parseService(n))});n.fetch(e);return!1}function parseService(e){e.operation?e.operation instanceof Array||(e.operation=[e.operation]):e.operation=[];for(var t=0;t<e.operation.length;t++){var n=e.operation[t];n.actionHandler?n.actionHandler instanceof Array||(n.actionHandler=[n.actionHandler]):n.actionHandler=[];for(var r=0;r<n.actionHandler.length;r++){handler=n.actionHandler[r];var i=handler.expects,s={};handler.params=s;for(var o in i){var u=i[o].name.split("."),a=n;for(var f in u){if(!a[u[f]]){a="INPUT";break}a=a[u[f]]}a?s[i[o].name]=a:s[i[o].name]="FORM!"}}}return e}function renderService(e,t){var n="";n+="<div>";n+="  <div>";n+="&nbsp;&nbsp; id: {$id}<br>";n=n.replace("{$service}",e["@type"]);n=n.replace("{$id}",e["@id"]);n=n.replace("{$name}",e.name);for(var r=0;r<e.operation.length;r++){var i=e.operation[r];if(i["@type"]!=t)continue;for(var s=0;s<i.actionHandler.length;s++){handler=i.actionHandler[s];handler.expects=handler.expects||[];var o=handler.expects,u=handler.params;n+="  <form id='invocation' method='{$httpMethod}' action='{$url}' handler='{$handler}' target='_blank'>";n+="    <input type='hidden' name='@type' value='"+i["@type"]+"'>";n+="    <br><br>";n+="&nbsp;&nbsp;  // {$comments}";n+="  <br>";for(var a=0;a<handler.expects.length;a++){var f=handler.expects[a];n+=renderSupportedClass(f.name+".",f)}n+="";n+="<br>";n=n.replace("{$comments}",handler.name);n=n.replace("{$operation}",i["@type"]);n=n.replace("{$fn}","fn"+i["@type"]);n=n.replace("{$returns}",handler.returns?handler.returns.subClassOf:"Void");n=n.replace("{$url}",e["@id"]);var l=handler.httpMethod||"GET";n=n.replace("{$httpMethod}",l);n=n.replace("{$handler}",handler["@type"]);n+="  </form>"}n+="<br>";n+="  </div>";n+="</div>"}return n}function f(e,t,n){loading();console.log("params:");console.log(n);for(var r in n)n[r]=="INPUT"&&(n[r]=document.getElementById(r).value);console.log("params values:");console.log(n);var i=paramsToInstance(n);console.log(i);i=JSON.stringify(i);console.log(i);var s=t.httpMethod||"GET";switch(t["@type"]){case"HttpHandler":var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState==4&&o.status==200){var t=o.responseXML,n=parseJsonLd(t);renderJson(e,n);loaded()}};o.open(s,e,!0);o.setRequestHeader("Content-type","application/json; charset=utf-8");o.responseType="document";o.send(i);break;case"WebParamsHandler":e+="?";for(var r in n){e+="&";e+=r;e+="=";e+=n[r]}window.open(e,"_blank");loaded();return;case"WebPageHandler":console.log(e);var u=document.createElement("form");u.setAttribute("action",e);u.setAttribute("target","_blank");u.setAttribute("method",s);document.body.appendChild(u);u.submit();loaded();return}}function paramsToInstance(e){var t={};for(var n in e){var r=n.split("."),i=t;console.log("Adding key: "+n);for(var s in r){console.log(r[s]);if(s==r.length-1){console.log("hey! setting "+e[n]);i[r[s]]=e[n]}else{i[r[s]]={};i=i[r[s]]}}console.log(t)}return t}Crawler=function(){goog.base(this)};goog.inherits(Crawler,goog.async.Deferred);Crawler.prototype.fetch=function(e){var t=new XMLHttpRequest,n=this;t.onreadystatechange=function(){t.readyState==4&&(t.status==200?n.callback(t):n.errback())};t.open("GET",e,!0);t.responseType="document";t.send()};