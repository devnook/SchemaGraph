$(document).ready(function(){var e=new actSbx.Google;$("#search").click(function(){e.search($("#search-term").val())});$("#fetch").click(function(){var t=$("#provider-url").val();e.crawl(t)})});var actSbx={};actSbx.Google=function(){this.url=null;this.jsonLd=null;this.entities=null;this.index=[]};actSbx.Google.prototype.parseHtml=function(e){var t=$.parseHTML(e);for(var n=0,r;r=t[n];n++)if(r.nodeName=="SCRIPT")var i=r;if(i)return obj=JSON.parse(i.innerHTML)};actSbx.Google.supportedEntityTypes=["Movie","MusicRecording","Restaurant"];actSbx.Google.supportedActionHandlerTypes=["WebPageHandler","HttpHandler"];actSbx.Google.prototype.crawl=function(e){var t=this;t.url=e;$.get(e,function(e){t.jsonLd=t.parseHtml(e);$("#log").text(JSON.stringify(t.jsonLd));$("#validation-errors").text("Validation errors go here");t.entities=t.jsonLd.mainContentOfPage;var n=$("#entities");for(var r=0,i;i=t.entities[r];r++)if(actSbx.Google.supportedEntityTypes.indexOf(i["@type"])>-1){var s=i.name.split(" ");for(var o=s.length-1;o>-1;o--)t.index[s[o]]=i;var u=i,a=Mustache.render("<li><b>{{@type}}</b>: {{name}}</li>",u);console.log(a);n.append($(a))}})};actSbx.Google.prototype.search=function(e){var t=this.index[e];if(t){console.log(this.index[e]);var n=this;$.get(this.url+t["@id"],function(e){var t=n.parseHtml(e);console.log(t);var r={url:this.url,entity:t,entityString:JSON.stringify(t)},i=Mustache.render('<div><a href="{{url}}">{{url}}</a><p>{{entity.@type}}: {{entity.name}} <span class="action-widget"></span></p>',r);$("#search-results").html(i);var s=new actSbx.RateActionWidget(t.operation,n.url+t["@id"]);s.render($("#search-results .action-widget"));s.eventEmitter.on("action-call",function(e,t,n){$("#provider-log").append($("<p>"+t+" "+n+"</p>"))});$("#search-results test").html(i)})}};actSbx.ActionWidget=function(e,t){this.url=e;this.method=t;this.eventEmitter=$("<span></span>")};actSbx.RateActionWidget=function(e,t){actSbx.ActionWidget.call(this,t,e.actionHandler[0].httpMethod);this.operation_=e;this.button_=null};actSbx.RateActionWidget.prototype=new actSbx.ActionWidget;actSbx.RateActionWidget.prototype.render=function(e){this.button_=$('<button class="action-link">Rate</button>');e.append(this.button_);var t=this;this.button_.on("click",$.proxy(this.popup,this))};actSbx.RateActionWidget.prototype.popup=function(){this.popup_=$('<div class="popup"><p>'+this.operation_.actionHandler[0].name+'</p><p><select><option value="1">1</option><option value="2">2</option><option value="3">3</option></select></p><p><a href="#" class="btn cancel">cancel</a></p></div>');$("body").append(this.popup_);var e=this;this.popup_.find(".cancel").on("click",function(){e.popup_.remove();return!1});this.popup_.find("select").change(function(){var t={type:e.method,data:{value:$(this).val()},complete:function(t){if(t.status===200){e.button_.text("Rated sucessfully!");e.button_.addClass("btn-success")}else{e.button_.text("Action unsuccessful:(");e.button_.addClass("btn-danger")}var n=t.status+" "+t.statusText+": "+this.url;console.log(t);e.eventEmitter.trigger("action-call",[n,this.data])}};$.ajax(e.url,t);e.popup_.remove();return!1})};